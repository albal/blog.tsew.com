---
layout: post
title: Testing unattended windows installations
date: 2012-10-04 13:56:12.000000000 +01:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- General
- Hyper-V
tags: []
meta:
  _edit_last: '11201131'
  _oembed_c5a6cfb29c3ed6f97586c0ad151df20c: "{{unknown}}"
  _oembed_c95c8de29910ef45fe6edf5584d2d4cd: "{{unknown}}"
  _oembed_2ae82e2ca0ab7c4af975888a6e2aca4d: "{{unknown}}"
  _oembed_a11df89ef291e5b2ec3ddfead1b55aa3: "{{unknown}}"
  _oembed_df6ff7749e1b9a79ecb527b554cdaa5c: "{{unknown}}"
  _oembed_10df37c8671665ee07429a9271da7085: "{{unknown}}"
author:
  login: albal21
  email: al@tsew.net
  display_name: Al
  first_name: ''
  last_name: ''
permalink: "/2012/10/04/testing-unattended-windows-installations/"
---
<p class="MsoNormal" style="margin-bottom:0;background:white;line-height:normal;">
<p class="MsoNormal" style="margin-bottom:0;background:white;line-height:normal;"></p>
<p>If you are creating unattended.xml files to use to perform automated installations of windows then you will at some point want to test it.&nbsp; This is fine if the destination system has a keyboard and monitor but in my case the system I am targeting does not, a HP MediaSmart EX490.</p>
<p>The simplest way I found on Windows 8 to do the testing was to use the Hyper-V role.&nbsp; Normally I prepare a USB stick with the <a href="http://emea.microsoftstore.com/UK/en-GB/Service-Centre/Windows-7-USB-DVD-Download-Tool" target="_blank">Microsoft USB/DVD Download Tool</a> and then copy the autounattend.xml file to the root of the USB disk.&nbsp; However, during installation Windows will search for an autounattend.xml or unattend.xml on other removable devices.&nbsp; Using this we can setup a Hyper-V VM with two DVD drives.&nbsp; One with the installation media in the other with just the autounattend.xml</p>
<p>I found on the internet a PowerShell script, New-IsoFile that will create an ISO from a list of files.&nbsp; Credit goes to Chris Woo and information can be found at <a title="http://gallery.technet.microsoft.com/scriptcenter/New-ISOFile-function-a8deeffd" href="http://gallery.technet.microsoft.com/scriptcenter/New-ISOFile-function-a8deeffd" target="_blank">http://gallery.technet.microsoft.com/scriptcenter/New-ISOFile-function-a8deeffd</a></p>
<p>Below is my PowerShell script that I use.&nbsp; Basically it uses Chrisâ€™s New-IsoFile function to create an ISO with the autounattend.xml file in it.&nbsp; It then creates a VM, attaches the Installation ISO (in this case Hyper-V Server) and the answer file ISO and starts the VM.</p>
<p class="MsoNormal" style="margin-bottom:0;background:white;line-height:normal;">
<p class="MsoNormal" style="margin-bottom:0;background:white;line-height:normal;">
<div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:c9703b98-24c6-4cf2-9540-93886e230620" class="wlWriterEditableSmartContent" style="float:none;margin:0;display:inline;padding:0;">
<pre style="width:580px;height:610px;background-color:White;white-space:-moz-pre-wrap;word-wrap:break-word;overflow:auto;" />
<div><span style="color:#0000FF;">function</span><span style="color:#000000;"> New</span><span style="color:#000000;">-</span><span style="color:#000000;">IsoFile<br />
{<br />
  &lt;</span><span style="color:#008000;">#<br />
</span><span style="color:#000000;">   .Synopsis<br />
    Creates a new .iso file<br />
   .Description<br />
    The New</span><span style="color:#000000;">-</span><span style="color:#000000;">IsoFile cmdlet creates a new .iso file containing content from chosen folders<br />
   .Example<br />
    New</span><span style="color:#000000;">-</span><span style="color:#000000;">IsoFile </span><span style="color:#800000;">&quot;</span><span style="color:#800000;">c:\tools</span><span style="color:#800000;">&quot;</span><span style="color:#000000;">,</span><span style="color:#800000;">&quot;</span><span style="color:#800000;">c:Downloads\utils</span><span style="color:#800000;">&quot;</span><span style="color:#000000;"><br />
    Description<br />
    </span><span style="color:#000000;">-----------</span><span style="color:#000000;"><br />
    This command creates a .iso file </span><span style="color:#0000FF;">in</span><span style="color:#000000;"> </span><span style="color:#800080;">$env:temp</span><span style="color:#000000;"> folder (</span><span style="color:#0000FF;">default</span><span style="color:#000000;"> location) that contains c:\tools and c:\downloads\utils folders. The folders themselves are added </span><span style="color:#0000FF;">in</span><span style="color:#000000;"> the root of the .iso image.<br />
   .Example<br />
    dir c:\WinPE </span><span style="color:#000000;">|</span><span style="color:#000000;"> New</span><span style="color:#000000;">-</span><span style="color:#000000;">IsoFile </span><span style="color:#000000;">-</span><span style="color:#000000;">Path c:\temp\WinPE.iso </span><span style="color:#000000;">-</span><span style="color:#000000;">BootFile etfsboot.com </span><span style="color:#000000;">-</span><span style="color:#000000;">Media DVDPLUSR </span><span style="color:#000000;">-</span><span style="color:#000000;">Title </span><span style="color:#800000;">&quot;</span><span style="color:#800000;">WinPE</span><span style="color:#800000;">&quot;</span><span style="color:#000000;"><br />
    Description<br />
    </span><span style="color:#000000;">-----------</span><span style="color:#000000;"><br />
    This command creates a bootable .iso file containing the content from c:\WinPE folder, but the folder itself isn't included. Boot file etfsboot.com can be found </span><span style="color:#0000FF;">in</span><span style="color:#000000;"> Windows AIK. Refer to IMAPI_MEDIA_PHYSICAL_TYPE enumeration </span><span style="color:#0000FF;">for</span><span style="color:#000000;"> possible media types:</p>
<p>      http:</span><span style="color:#000000;">//</span><span style="color:#000000;">msdn.microsoft.com</span><span style="color:#000000;">/</span><span style="color:#000000;">en</span><span style="color:#000000;">-</span><span style="color:#000000;">us</span><span style="color:#000000;">/</span><span style="color:#000000;">library</span><span style="color:#000000;">/</span><span style="color:#000000;">windows</span><span style="color:#000000;">/</span><span style="color:#000000;">desktop</span><span style="color:#000000;">/</span><span style="color:#000000;">aa366217(v</span><span style="color:#000000;">=</span><span style="color:#000000;">vs.</span><span style="color:#000000;">85</span><span style="color:#000000;">).aspx<br />
   .Notes<br />
    NAME:  New</span><span style="color:#000000;">-</span><span style="color:#000000;">IsoFile<br />
    AUTHOR: Chris Wu<br />
    LASTEDIT: </span><span style="color:#000000;">03</span><span style="color:#000000;">/</span><span style="color:#000000;">06</span><span style="color:#000000;">/</span><span style="color:#000000;">2012</span><span style="color:#000000;"> </span><span style="color:#000000;">14</span><span style="color:#000000;">:</span><span style="color:#000000;">06</span><span style="color:#000000;">:</span><span style="color:#000000;">16</span><span style="color:#000000;"><br />
 </span><span style="color:#008000;">#</span><span style="color:#008000;">&gt;</span><span style="color:#008000;"><br />
</span><span style="color:#000000;"><br />
  </span><span style="color:#0000FF;">Param</span><span style="color:#000000;"> (<br />
    [parameter(Position</span><span style="color:#000000;">=</span><span style="color:#000000;">0</span><span style="color:#000000;">,Mandatory</span><span style="color:#000000;">=</span><span style="color:#0000FF;">$true</span><span style="color:#000000;">,ValueFromPipeline</span><span style="color:#000000;">=</span><span style="color:#0000FF;">$true</span><span style="color:#000000;">)]</span><span style="color:#800080;">$Source</span><span style="color:#000000;">,<br />
    [parameter(Position</span><span style="color:#000000;">=</span><span style="color:#000000;">1</span><span style="color:#000000;">)][string]</span><span style="color:#800080;">$Path</span><span style="color:#000000;"> </span><span style="color:#000000;">=</span><span style="color:#000000;"> </span><span style="color:#800000;">&quot;</span><span style="color:#800000;">$($env:temp)\</span><span style="color:#800000;">&quot;</span><span style="color:#000000;"> </span><span style="color:#000000;">+</span><span style="color:#000000;"> (Get</span><span style="color:#000000;">-</span><span style="color:#000000;">Date).ToString(</span><span style="color:#800000;">&quot;</span><span style="color:#800000;">yyyyMMdd-HHmmss.ffff</span><span style="color:#800000;">&quot;</span><span style="color:#000000;">) </span><span style="color:#000000;">+</span><span style="color:#000000;"> </span><span style="color:#800000;">&quot;</span><span style="color:#800000;">.iso</span><span style="color:#800000;">&quot;</span><span style="color:#000000;">,<br />
    [string] </span><span style="color:#800080;">$BootFile</span><span style="color:#000000;"> </span><span style="color:#000000;">=</span><span style="color:#000000;"> </span><span style="color:#800080;">$null</span><span style="color:#000000;">,<br />
    [string] </span><span style="color:#800080;">$Media</span><span style="color:#000000;"> </span><span style="color:#000000;">=</span><span style="color:#000000;"> </span><span style="color:#800000;">&quot;</span><span style="color:#800000;">Disk</span><span style="color:#800000;">&quot;</span><span style="color:#000000;">,<br />
    [string] </span><span style="color:#800080;">$Title</span><span style="color:#000000;"> </span><span style="color:#000000;">=</span><span style="color:#000000;"> (Get</span><span style="color:#000000;">-</span><span style="color:#000000;">Date).ToString(</span><span style="color:#800000;">&quot;</span><span style="color:#800000;">yyyyMMdd-HHmmss.ffff</span><span style="color:#800000;">&quot;</span><span style="color:#000000;">),<br />
    [</span><span style="color:#0000FF;">switch</span><span style="color:#000000;">] </span><span style="color:#800080;">$Force</span><span style="color:#000000;"><br />
  )</span><span style="color:#008000;">#</span><span style="color:#008000;">End Param</span><span style="color:#008000;"><br />
</span><span style="color:#000000;"><br />
  </span><span style="color:#0000FF;">Begin</span><span style="color:#000000;"> {<br />
    (</span><span style="color:#800080;">$cp</span><span style="color:#000000;"> </span><span style="color:#000000;">=</span><span style="color:#000000;"> new</span><span style="color:#000000;">-</span><span style="color:#000000;">object System.CodeDom.Compiler.CompilerParameters).CompilerOptions </span><span style="color:#000000;">=</span><span style="color:#000000;"> </span><span style="color:#800000;">&quot;</span><span style="color:#800000;">/unsafe</span><span style="color:#800000;">&quot;</span><span style="color:#000000;"><br />
    </span><span style="color:#0000FF;">if</span><span style="color:#000000;"> (</span><span style="color:#000000;">!</span><span style="color:#000000;">(</span><span style="color:#800000;">&quot;</span><span style="color:#800000;">ISOFile</span><span style="color:#800000;">&quot;</span><span style="color:#000000;"> </span><span style="color:#008080;">-as</span><span style="color:#000000;"> [type])) {<br />
      Add</span><span style="color:#000000;">-</span><span style="color:#000000;">Type </span><span style="color:#000000;">-</span><span style="color:#000000;">CompilerParameters </span><span style="color:#800080;">$cp</span><span style="color:#000000;"> </span><span style="color:#000000;">-</span><span style="color:#000000;">TypeDefinition </span><span style="color:#000000;">@</span><span style="color:#800000;">&quot;</span><span style="color:#800000;"><br />
public class ISOFile<br />
{<br />
    public unsafe static void Create(string Path, object Stream, int BlockSize, int TotalBlocks)<br />
    {<br />
        int bytes = 0;<br />
        byte[] buf = new byte[BlockSize];<br />
        System.IntPtr ptr = (System.IntPtr)(&amp;bytes);<br />
        System.IO.FileStream o = System.IO.File.OpenWrite(Path);<br />
        System.Runtime.InteropServices.ComTypes.IStream i = Stream as System.Runtime.InteropServices.ComTypes.IStream;</p>
<p>        if (o == null) { return; }<br />
        while (TotalBlocks-- &gt; 0) {<br />
            i.Read(buf, BlockSize, ptr); o.Write(buf, 0, bytes);<br />
        }<br />
        o.Flush(); o.Close();<br />
    }<br />
}<br />
</span><span style="color:#800000;">&quot;</span><span style="color:#000000;">@</span><span style="color:#000000;"><br />
    }</span><span style="color:#008000;">#</span><span style="color:#008000;">End If</span><span style="color:#008000;"><br />
</span><span style="color:#000000;"><br />
    </span><span style="color:#0000FF;">if</span><span style="color:#000000;"> (</span><span style="color:#800080;">$BootFile</span><span style="color:#000000;"> </span><span style="color:#008080;">-and</span><span style="color:#000000;"> (Test</span><span style="color:#000000;">-</span><span style="color:#000000;">Path </span><span style="color:#800080;">$BootFile</span><span style="color:#000000;">)) {<br />
      (</span><span style="color:#800080;">$Stream</span><span style="color:#000000;"> </span><span style="color:#000000;">=</span><span style="color:#000000;"> New</span><span style="color:#000000;">-</span><span style="color:#000000;">Object </span><span style="color:#000000;">-</span><span style="color:#000000;">ComObject ADODB.Stream).Open()<br />
      </span><span style="color:#800080;">$Stream</span><span style="color:#000000;">.Type </span><span style="color:#000000;">=</span><span style="color:#000000;"> </span><span style="color:#000000;">1</span><span style="color:#000000;">  </span><span style="color:#008000;">#</span><span style="color:#008000;"> adFileTypeBinary</span><span style="color:#008000;"><br />
</span><span style="color:#000000;">      </span><span style="color:#800080;">$Stream</span><span style="color:#000000;">.LoadFromFile((Get</span><span style="color:#000000;">-</span><span style="color:#000000;">Item </span><span style="color:#800080;">$BootFile</span><span style="color:#000000;">).Fullname)<br />
      (</span><span style="color:#800080;">$Boot</span><span style="color:#000000;"> </span><span style="color:#000000;">=</span><span style="color:#000000;"> New</span><span style="color:#000000;">-</span><span style="color:#000000;">Object </span><span style="color:#000000;">-</span><span style="color:#000000;">ComObject IMAPI2FS.BootOptions).AssignBootImage(</span><span style="color:#800080;">$Stream</span><span style="color:#000000;">)<br />
    }</span><span style="color:#008000;">#</span><span style="color:#008000;">End If</span><span style="color:#008000;"><br />
</span><span style="color:#000000;"><br />
    </span><span style="color:#800080;">$MediaType</span><span style="color:#000000;"> </span><span style="color:#000000;">=</span><span style="color:#000000;"> </span><span style="color:#000000;">@</span><span style="color:#000000;">{CDR</span><span style="color:#000000;">=</span><span style="color:#000000;">2</span><span style="color:#000000;">; CDRW</span><span style="color:#000000;">=</span><span style="color:#000000;">3</span><span style="color:#000000;">; DVDRAM</span><span style="color:#000000;">=</span><span style="color:#000000;">5</span><span style="color:#000000;">; DVDPLUSR</span><span style="color:#000000;">=</span><span style="color:#000000;">6</span><span style="color:#000000;">; DVDPLUSRW</span><span style="color:#000000;">=</span><span style="color:#000000;">7</span><span style="color:#000000;">; `<br />
      DVDPLUSR_DUALLAYER</span><span style="color:#000000;">=</span><span style="color:#000000;">8</span><span style="color:#000000;">; DVDDASHR</span><span style="color:#000000;">=</span><span style="color:#000000;">9</span><span style="color:#000000;">; DVDDASHRW</span><span style="color:#000000;">=</span><span style="color:#000000;">10</span><span style="color:#000000;">; DVDDASHR_DUALLAYER</span><span style="color:#000000;">=</span><span style="color:#000000;">11</span><span style="color:#000000;">; `<br />
      DISK</span><span style="color:#000000;">=</span><span style="color:#000000;">12</span><span style="color:#000000;">; DVDPLUSRW_DUALLAYER</span><span style="color:#000000;">=</span><span style="color:#000000;">13</span><span style="color:#000000;">; BDR</span><span style="color:#000000;">=</span><span style="color:#000000;">18</span><span style="color:#000000;">; BDRE</span><span style="color:#000000;">=</span><span style="color:#000000;">19</span><span style="color:#000000;"> }</p>
<p>    </span><span style="color:#0000FF;">if</span><span style="color:#000000;"> (</span><span style="color:#800080;">$MediaType</span><span style="color:#000000;">[</span><span style="color:#800080;">$Media</span><span style="color:#000000;">] </span><span style="color:#008080;">-eq</span><span style="color:#000000;"> </span><span style="color:#800080;">$null</span><span style="color:#000000;">) { write</span><span style="color:#000000;">-</span><span style="color:#000000;">debug </span><span style="color:#800000;">&quot;</span><span style="color:#800000;">Unsupported Media Type: $Media</span><span style="color:#800000;">&quot;</span><span style="color:#000000;">; write</span><span style="color:#000000;">-</span><span style="color:#000000;">debug (</span><span style="color:#800000;">&quot;</span><span style="color:#800000;">Choose one from: </span><span style="color:#800000;">&quot;</span><span style="color:#000000;"> </span><span style="color:#000000;">+</span><span style="color:#000000;"> </span><span style="color:#800080;">$MediaType</span><span style="color:#000000;">.Keys); </span><span style="color:#0000FF;">break</span><span style="color:#000000;"> }<br />
    (</span><span style="color:#800080;">$Image</span><span style="color:#000000;"> </span><span style="color:#000000;">=</span><span style="color:#000000;"> new</span><span style="color:#000000;">-</span><span style="color:#000000;">object </span><span style="color:#000000;">-</span><span style="color:#000000;">com IMAPI2FS.MsftFileSystemImage </span><span style="color:#000000;">-</span><span style="color:#000000;">Property </span><span style="color:#000000;">@</span><span style="color:#000000;">{VolumeName</span><span style="color:#000000;">=</span><span style="color:#800080;">$Title</span><span style="color:#000000;">}).ChooseImageDefaultsForMediaType(</span><span style="color:#800080;">$MediaType</span><span style="color:#000000;">[</span><span style="color:#800080;">$Media</span><span style="color:#000000;">])</p>
<p>    </span><span style="color:#0000FF;">if</span><span style="color:#000000;"> ((Test</span><span style="color:#000000;">-</span><span style="color:#000000;">Path </span><span style="color:#800080;">$Path</span><span style="color:#000000;">) </span><span style="color:#008080;">-and</span><span style="color:#000000;"> (</span><span style="color:#000000;">!</span><span style="color:#800080;">$Force</span><span style="color:#000000;">)) { </span><span style="color:#800000;">&quot;</span><span style="color:#800000;">File Exists $Path</span><span style="color:#800000;">&quot;</span><span style="color:#000000;">; </span><span style="color:#0000FF;">break</span><span style="color:#000000;"> }<br />
    </span><span style="color:#0000FF;">if</span><span style="color:#000000;"> (</span><span style="color:#000000;">!</span><span style="color:#000000;">(</span><span style="color:#800080;">$Target</span><span style="color:#000000;"> </span><span style="color:#000000;">=</span><span style="color:#000000;"> New</span><span style="color:#000000;">-</span><span style="color:#000000;">Item </span><span style="color:#000000;">-</span><span style="color:#000000;">Path </span><span style="color:#800080;">$Path</span><span style="color:#000000;"> </span><span style="color:#000000;">-</span><span style="color:#000000;">ItemType File </span><span style="color:#000000;">-</span><span style="color:#000000;">Force)) { </span><span style="color:#800000;">&quot;</span><span style="color:#800000;">Cannot create file $Path</span><span style="color:#800000;">&quot;</span><span style="color:#000000;">; </span><span style="color:#0000FF;">break</span><span style="color:#000000;"> }<br />
  }</p>
<p>  </span><span style="color:#0000FF;">Process</span><span style="color:#000000;"> {<br />
    </span><span style="color:#0000FF;">switch</span><span style="color:#000000;"> (</span><span style="color:#800080;">$Source</span><span style="color:#000000;">) {<br />
      { </span><span style="color:#800080;">$_</span><span style="color:#000000;"> </span><span style="color:#008080;">-is</span><span style="color:#000000;"> [string] } { </span><span style="color:#800080;">$Image</span><span style="color:#000000;">.Root.AddTree((Get</span><span style="color:#000000;">-</span><span style="color:#000000;">Item </span><span style="color:#800080;">$_</span><span style="color:#000000;">).FullName, </span><span style="color:#0000FF;">$true</span><span style="color:#000000;">); </span><span style="color:#0000FF;">continue</span><span style="color:#000000;"> }<br />
      { </span><span style="color:#800080;">$_</span><span style="color:#000000;"> </span><span style="color:#008080;">-is</span><span style="color:#000000;"> [IO.FileInfo] } { </span><span style="color:#800080;">$Image</span><span style="color:#000000;">.Root.AddTree(</span><span style="color:#800080;">$_</span><span style="color:#000000;">.FullName, </span><span style="color:#0000FF;">$true</span><span style="color:#000000;">); </span><span style="color:#0000FF;">continue</span><span style="color:#000000;"> }<br />
      { </span><span style="color:#800080;">$_</span><span style="color:#000000;"> </span><span style="color:#008080;">-is</span><span style="color:#000000;"> [IO.DirectoryInfo] } { </span><span style="color:#800080;">$Image</span><span style="color:#000000;">.Root.AddTree(</span><span style="color:#800080;">$_</span><span style="color:#000000;">.FullName, </span><span style="color:#0000FF;">$true</span><span style="color:#000000;">); </span><span style="color:#0000FF;">continue</span><span style="color:#000000;"> }<br />
    }</span><span style="color:#008000;">#</span><span style="color:#008000;">End switch</span><span style="color:#008000;"><br />
</span><span style="color:#000000;">  }</span><span style="color:#008000;">#</span><span style="color:#008000;">End Process</span><span style="color:#008000;"><br />
</span><span style="color:#000000;"><br />
  </span><span style="color:#0000FF;">End</span><span style="color:#000000;"> {<br />
    </span><span style="color:#0000FF;">if</span><span style="color:#000000;"> (</span><span style="color:#800080;">$Boot</span><span style="color:#000000;">) { </span><span style="color:#800080;">$Image</span><span style="color:#000000;">.BootImageOptions</span><span style="color:#000000;">=</span><span style="color:#800080;">$Boot</span><span style="color:#000000;"> }<br />
    </span><span style="color:#800080;">$Result</span><span style="color:#000000;"> </span><span style="color:#000000;">=</span><span style="color:#000000;"> </span><span style="color:#800080;">$Image</span><span style="color:#000000;">.CreateResultImage()<br />
    [ISOFile]</span><span style="color:#000000;">::</span><span style="color:#000000;">Create(</span><span style="color:#800080;">$Target</span><span style="color:#000000;">.FullName,</span><span style="color:#800080;">$Result</span><span style="color:#000000;">.ImageStream,</span><span style="color:#800080;">$Result</span><span style="color:#000000;">.BlockSize,</span><span style="color:#800080;">$Result</span><span style="color:#000000;">.TotalBlocks)<br />
    </span><span style="color:#800080;">$Target</span><span style="color:#000000;"><br />
  }</span><span style="color:#008000;">#</span><span style="color:#008000;">End End</span><span style="color:#008000;"><br />
</span><span style="color:#000000;">}</span><span style="color:#008000;">#</span><span style="color:#008000;">End function New-IsoFile</span><span style="color:#008000;"><br />
</span><span style="color:#000000;"><br />
</span><span style="color:#008000;">#</span><span style="color:#008000;"> Begin script by Albal to create New-VM based on autounattend.xml -</span><span style="color:#008000;"><br />
#</span><span style="color:#008000;"> Assumes all required files are in, and will be written to &lt;USER&gt;\Downloads</span><span style="color:#008000;"><br />
#</span><span style="color:#008000;"> Change the below parameters if needed</span><span style="color:#008000;"><br />
</span><span style="color:#000000;"><br />
</span><span style="color:#800080;">$path</span><span style="color:#000000;"> </span><span style="color:#000000;">=</span><span style="color:#000000;"> [Environment]</span><span style="color:#000000;">::</span><span style="color:#000000;">GetFolderPath(</span><span style="color:#800000;">&quot;</span><span style="color:#800000;">UserProfile</span><span style="color:#800000;">&quot;</span><span style="color:#000000;">) </span><span style="color:#000000;">+</span><span style="color:#000000;"> </span><span style="color:#800000;">&quot;</span><span style="color:#800000;">\Downloads</span><span style="color:#800000;">&quot;</span><span style="color:#000000;"><br />
</span><span style="color:#800080;">$name</span><span style="color:#000000;"> </span><span style="color:#000000;">=</span><span style="color:#000000;"> </span><span style="color:#800000;">&quot;</span><span style="color:#800000;">Hyper-V Server 2012</span><span style="color:#800000;">&quot;</span><span style="color:#000000;"><br />
</span><span style="color:#800080;">$switch</span><span style="color:#000000;"> </span><span style="color:#000000;">=</span><span style="color:#000000;"> </span><span style="color:#800000;">&quot;</span><span style="color:#800000;">vSwitch</span><span style="color:#800000;">&quot;</span><span style="color:#000000;"></p>
<p></span><span style="color:#008000;">#</span><span style="color:#008000;"> Don't change anything below this line - ignore the errors below, just in case you run the script again without having exited expectedly</span><span style="color:#008000;"><br />
</span><span style="color:#000000;"><br />
Stop</span><span style="color:#000000;">-</span><span style="color:#000000;">VM </span><span style="color:#000000;">-</span><span style="color:#000000;">Name </span><span style="color:#800080;">$name</span><span style="color:#000000;"> </span><span style="color:#000000;">-</span><span style="color:#000000;">Force </span><span style="color:#000000;">-</span><span style="color:#000000;">TurnOff<br />
Remove</span><span style="color:#000000;">-</span><span style="color:#000000;">VM  </span><span style="color:#000000;">-</span><span style="color:#000000;">Name </span><span style="color:#800080;">$name</span><span style="color:#000000;"> </span><span style="color:#000000;">-</span><span style="color:#000000;">Force<br />
del </span><span style="color:#000000;">-</span><span style="color:#000000;">Force </span><span style="color:#800080;">$path</span><span style="color:#000000;">\auto.iso<br />
del </span><span style="color:#000000;">-</span><span style="color:#000000;">Force </span><span style="color:#800080;">$path</span><span style="color:#000000;">\hyper</span><span style="color:#000000;">-</span><span style="color:#000000;">v.vhd</p>
<p>dir </span><span style="color:#800080;">$path</span><span style="color:#000000;">\autounattend.xml </span><span style="color:#000000;">|</span><span style="color:#000000;"> New</span><span style="color:#000000;">-</span><span style="color:#000000;">IsoFile </span><span style="color:#000000;">-</span><span style="color:#000000;">Path </span><span style="color:#800080;">$path</span><span style="color:#000000;">\auto.iso </span><span style="color:#000000;">-</span><span style="color:#000000;">Media CDR </span><span style="color:#000000;">-</span><span style="color:#000000;">Title </span><span style="color:#800000;">&quot;</span><span style="color:#800000;">Unattend</span><span style="color:#800000;">&quot;</span><span style="color:#000000;"></p>
<p>New</span><span style="color:#000000;">-</span><span style="color:#000000;">Vm </span><span style="color:#000000;">-</span><span style="color:#000000;">Name </span><span style="color:#800080;">$name</span><span style="color:#000000;"> </span><span style="color:#000000;">-</span><span style="color:#000000;">SwitchName </span><span style="color:#800080;">$switch</span><span style="color:#000000;"><br />
Set</span><span style="color:#000000;">-</span><span style="color:#000000;">VMProcessor </span><span style="color:#000000;">-</span><span style="color:#000000;">VMName </span><span style="color:#800080;">$name</span><span style="color:#000000;"> </span><span style="color:#000000;">-</span><span style="color:#000000;">Count </span><span style="color:#000000;">1</span><span style="color:#000000;"><br />
Set</span><span style="color:#000000;">-</span><span style="color:#000000;">VMMemory </span><span style="color:#000000;">-</span><span style="color:#000000;">VMName </span><span style="color:#800080;">$name</span><span style="color:#000000;"> </span><span style="color:#000000;">-</span><span style="color:#000000;">StartupBytes </span><span style="color:#000000;">2147483648</span><span style="color:#000000;"><br />
New</span><span style="color:#000000;">-</span><span style="color:#000000;">VHD </span><span style="color:#000000;">-</span><span style="color:#000000;">Path </span><span style="color:#800080;">$path</span><span style="color:#000000;">\hyper</span><span style="color:#000000;">-</span><span style="color:#000000;">v.vhd </span><span style="color:#000000;">-</span><span style="color:#000000;">SizeBytes </span><span style="color:#000000;">21474836480</span><span style="color:#000000;"> </p>
<p>Add</span><span style="color:#000000;">-</span><span style="color:#000000;">VMHardDiskDrive </span><span style="color:#000000;">-</span><span style="color:#000000;">VMName </span><span style="color:#800080;">$name</span><span style="color:#000000;"> </span><span style="color:#000000;">-</span><span style="color:#000000;">Path </span><span style="color:#800080;">$path</span><span style="color:#000000;">\hyper</span><span style="color:#000000;">-</span><span style="color:#000000;">v.vhd </span><span style="color:#000000;">-</span><span style="color:#000000;">ControllerType IDE </span><span style="color:#000000;">-</span><span style="color:#000000;">ControllerNumber </span><span style="color:#000000;">0</span><span style="color:#000000;"> </span><span style="color:#000000;">-</span><span style="color:#000000;">ControllerLocation </span><span style="color:#000000;">0</span><span style="color:#000000;"><br />
Set</span><span style="color:#000000;">-</span><span style="color:#000000;">VMDvdDrive </span><span style="color:#000000;">-</span><span style="color:#000000;">VMName </span><span style="color:#800080;">$name</span><span style="color:#000000;"> </span><span style="color:#000000;">-</span><span style="color:#000000;">Path </span><span style="color:#800080;">$path</span><span style="color:#000000;">\en_microsoft_hyper</span><span style="color:#000000;">-</span><span style="color:#000000;">v_server_2012_x64_dvd_915600.iso </span><span style="color:#000000;">-</span><span style="color:#000000;">ControllerNumber </span><span style="color:#000000;">1</span><span style="color:#000000;"> </span><span style="color:#000000;">-</span><span style="color:#000000;">ControllerLocation </span><span style="color:#000000;">0</span><span style="color:#000000;"><br />
Add</span><span style="color:#000000;">-</span><span style="color:#000000;">VMDvdDrive </span><span style="color:#000000;">-</span><span style="color:#000000;">VMName </span><span style="color:#800080;">$name</span><span style="color:#000000;"> </span><span style="color:#000000;">-</span><span style="color:#000000;">Path </span><span style="color:#800080;">$path</span><span style="color:#000000;">\auto.iso </span><span style="color:#000000;">-</span><span style="color:#000000;">ControllerNumber </span><span style="color:#000000;">1</span><span style="color:#000000;"> </span><span style="color:#000000;">-</span><span style="color:#000000;">ControllerLocation </span><span style="color:#000000;">1</span><span style="color:#000000;"></p>
<p>Start</span><span style="color:#000000;">-</span><span style="color:#000000;">VM </span><span style="color:#000000;">-</span><span style="color:#000000;">Name </span><span style="color:#800080;">$name</span><span style="color:#000000;"></p>
<p>echo </span><span style="color:#800000;">&quot;</span><span style="color:#800000;">When you press enter the Virtual Machine will be stopped and deleted</span><span style="color:#800000;">&quot;</span><span style="color:#000000;"><br />
pause</p>
<p>Stop</span><span style="color:#000000;">-</span><span style="color:#000000;">VM </span><span style="color:#000000;">-</span><span style="color:#000000;">Name </span><span style="color:#800080;">$name</span><span style="color:#000000;"> </span><span style="color:#000000;">-</span><span style="color:#000000;">Force </span><span style="color:#000000;">-</span><span style="color:#000000;">TurnOff<br />
Remove</span><span style="color:#000000;">-</span><span style="color:#000000;">VM  </span><span style="color:#000000;">-</span><span style="color:#000000;">Name </span><span style="color:#800080;">$name</span><span style="color:#000000;"> </span><span style="color:#000000;">-</span><span style="color:#000000;">Force<br />
del </span><span style="color:#800080;">$path</span><span style="color:#000000;">\hyper</span><span style="color:#000000;">-</span><span style="color:#000000;">v.vhd<br />
del </span><span style="color:#800080;">$path</span><span style="color:#000000;">\auto.iso</p>
<p></span></div>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div></p>
<p class="MsoNormal" style="margin-bottom:0;background:white;line-height:normal;"><span style="font-size:9pt;font-family:'Lucida Console';"></span>&nbsp;</p>
<p>Simply run the Script and Open the VM in Hyper-V Manager, you can then verify the automated install works and if not have an easier time of debugging the situation than if you were running on a headless system.</p></p>
